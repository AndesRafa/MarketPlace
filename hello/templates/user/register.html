{% include "header.html" %}
    <section>
    <div class="section primary-color-background">
        <div class="container">
            <div class="p-t-70 p-b-85">
                <!-- Heading page-->
                <div class="heading-page-1">
                    <h3>Registrar Usuario</h3>
                </div>
            </div>
        </div>
    </div>
	</section>
    <section>
        <div class="section white-background p-t-30 p-b-30">
            <div class="container">
                <!-- Heading Section-->
                <div class="row">
					<div class="col-md-4 col-md-push-4">
						<!-- .register-1-->
						<div class="register-1">
                            <input type="text" class="theme-input-text" id="name" placeholder="Nombres">
                            <input type="text" class="theme-input-text" id="lastname" placeholder="Apellidos">
                            <input type="text" class="theme-input-text" id="username" placeholder="Username">
                            <input type="email" class="theme-input-text" id="email" placeholder="Email">
                            <input type="password" class="theme-input-text" id="pass1" placeholder="Password">
                            <input type="password" class="theme-input-text" id="pass2" placeholder="Confirmar Password">
                            <button id="register" class="au-btn au-btn-border au-btn-radius btn-block btn-submit">Registrarse</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>
        $( document ).ready(function() {
            var url = window.location.origin + "/";
            var  _doAjax = function (sType, uri, data, fnSuccess, fnError, _async) {
                 if (!data) data = {};
                 if (!fnError) fnError = this._defaultErrorHandler;
                 if (!_async) _async = true;
                 $.ajax({
                     type: sType,
                     url: url + uri,
                     data: data,
                     async: _async,
                     contentType: "application/json; charset=utf-8",
                     dataType: "json",
                     success: fnSuccess,
                     error: fnError
                 });
            };

            function validateEmail(email) {
              var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
              return re.test(email);
            };

            var getUser = function () {
                var user = {} ;
                user.name = $('#name').val();
                user.lastname = $('#lastname').val();
                user.username = $('#username').val();
                user.email = $('#email').val();
                user.pass1 = $('#pass1').val();
                user.pass2 = $('#pass2').val();
                //console.log(user)
                return user;
            }

            var validateFields = function (user) {
                if(    user.name.length <= 0
                    || user.lastname.length <= 0
                    || user.username.length <= 0
                    || user.email.length <= 0
                    || user.pass1.length <= 0
                    || user.pass2.length <= 0)
                    alert("Todos los campos son requeridos");
                else if(!validateEmail(user.email))
                    alert("Digite un email valido!");
                else if(user.pass1 != user.pass2)
                    alert("Las contraseÃ±as no son iguales!")
                else
                    return true;

                return false;
            };

            var cleanFields = function () {
                $('#name').val("");
                $('#lastname').val("");
                $('#username').val("");
                $('#email').val("");
                $('#pass1').val("");
                $('#pass2').val("");
                //console.log(user)
            };

            var saveUser = function () {
                var user = getUser();
                if(validateFields(user)){
                    _doAjax("POST", "addUser/" , JSON.stringify(user) ,function (resp) {
                        console.log(resp);
                        //var resp = JSON.parse(res);
                        if(!resp.success)
                            alert(resp.message);
                        else if (resp.success){
                            alert(resp.message);
                        }
                        cleanFields();
                    },function (err) {
                        console.log("err", err);
                        var resp = JSON.parse(err.responseText);
                        //console.log(resp);
                        if(!resp.success)
                            alert(resp.message);
                        else if (resp.success){
                            alert(resp.message);
                        }
                        cleanFields();
                    },true);
                    cleanFields();
                }
            };

            $( "#register" ).click(function() {
                saveUser();
            });

        });
    </script>

{% include "footer.html" %}